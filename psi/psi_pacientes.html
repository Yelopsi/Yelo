<div class="main-header">
    <div class="header-content">
        <h1>Meus Pacientes</h1>
        <p>Gerencie seus atendimentos e sua agenda.</p>
    </div>
    <div class="dashboard-header-actions">
        <button id="btn-add-patient" class="btn" style="background-color: #fff; color: #1B4332; display: flex; align-items: center; gap: 8px; border: 1px solid #e0e0e0; box-shadow: 0 4px 12px rgba(0,0,0,0.05);">
            <span style="font-size: 1.2rem; line-height: 0;">+</span> Novo Paciente
        </button>
    </div>
</div>

    <div class="patients-layout-grid">
    
    <!-- COLUNA 1: LISTA DE PACIENTES -->
    <div class="widget" style="display: flex; flex-direction: column; height: 100%;">
        <div class="widget-header-row">
            <h3 class="widget-title">Carteira de Pacientes</h3>
            <span class="badge-count" id="patient-count">0</span>
        </div>

        <div class="search-wrapper" style="margin-bottom: 15px;">
            <input type="text" id="search-patient" placeholder="Buscar por nome..." class="form-control" style="width: 100%; box-sizing: border-box; border-radius: 20px; padding: 12px 20px; border: 1px solid #eee; background-color: #f9fafb;">
        </div>

        <div class="patient-list-container" id="patient-list">
            <!-- Lista renderizada via JS -->
            <div class="empty-state-patients">
                <p>Nenhum paciente cadastrado.</p>
            </div>
        </div>
    </div>

    <!-- COLUNA 2: CALEND√ÅRIO -->
    <div class="widget">
        <div class="widget-header-row">
            <h3 style="margin: 0;">Agenda</h3>
            <div class="calendar-legend">
                <span class="legend-item"><span class="dot available"></span> Realizado</span>
                <span class="legend-item"><span class="dot busy"></span> Agendado</span>
                <span class="legend-item"><span class="dot" style="background:#e0e0e0;"></span> Falta</span>
            </div>
        </div>
        <div id="calendar-wrapper"></div>
    </div>
    </div>
</div>

<!-- MODAL: ADICIONAR/EDITAR PACIENTE -->
<div id="modal-patient" class="custom-modal-overlay" style="display: none;">
    <div class="custom-modal-box">
        <button class="modal-close-btn" id="close-patient-modal"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
        <h3 id="modal-patient-title" style="margin-top: 0; color: #1B4332;">Novo Paciente</h3>
        
        <form id="form-patient">
            <input type="hidden" id="p-id"> <!-- ID oculto para edi√ß√£o -->
            <div class="form-group">
                <label>Nome Completo *</label>
                <input type="text" id="p-name" required placeholder="Ex: Jo√£o Silva">
            </div>
            
            <div class="form-row">
                <div class="form-group" style="flex: 1;">
                    <label>WhatsApp *</label>
                    <input type="tel" id="p-phone" required placeholder="(00) 00000-0000">
                </div>
                <div class="form-group" style="flex: 1;">
                    <label>E-mail (Opcional)</label>
                    <input type="email" id="p-email" placeholder="joao@email.com">
                </div>
                <div class="form-group" style="flex: 1;">
                    <label>Valor da Sess√£o (R$)</label>
                    <input type="number" id="p-session-value" placeholder="0,00" step="0.01" required>
                </div>
            </div>

            <div class="form-group highlight-box assistant-card" style="margin-top: 15px;">
                <div style="display: flex; align-items: flex-start; gap: 15px;">
                    <div class="assistant-icon">ü§ñ</div>
                    <div>
                        <div style="display: flex; align-items: center; justify-content: space-between; width: 100%;">
                            <label for="p-automated-msg" style="font-weight: bold; color: #1B4332; cursor: pointer; font-size: 1rem;">Ativar Assistente Pessoal</label>
                            <label class="switch-toggle">
                                <input type="checkbox" id="p-automated-msg" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <p style="font-size: 0.85rem; color: #555; margin: 8px 0 0 0; line-height: 1.4;">
                            Enviaremos lembretes autom√°ticos de sess√£o e confirma√ß√£o de hor√°rio via WhatsApp.
                        </p>
                    </div>
                </div>
            </div>

            <div class="form-actions" style="justify-content: space-between; margin-top: 25px; display: flex; align-items: center;">
                <!-- Bot√£o de Excluir (S√≥ aparece na edi√ß√£o) -->
                <button type="button" id="btn-delete-patient" style="display: none; background: none; border: none; color: #d32f2f; cursor: pointer; padding: 8px; border-radius: 50%; transition: background 0.2s;" title="Excluir Paciente">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                </button>

                <div style="display: flex; gap: 10px; margin-left: auto;">
                    <button type="button" class="btn btn-secundario" id="cancel-patient-modal">Cancelar</button>
                    <button type="submit" class="btn btn-principal">Salvar</button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- MODAL: AGENDAMENTO (NOVO) -->
<div id="modal-appointment" class="custom-modal-overlay" style="display: none;">
    <div class="custom-modal-box">
        <button class="modal-close-btn" id="close-appointment-modal"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
        <h3 id="modal-appointment-title" style="margin-top: 0; color: #1B4332;">Novo Agendamento</h3>
        
        <form id="form-appointment">
            <div class="form-group">
                <label>Paciente</label>
                <select id="appt-patient" required style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ccc; background-color: #f9fafb;">
                    <option value="">Selecione...</option>
                    <!-- Preenchido via JS -->
                </select>
            </div>
            
            <div class="form-row">
                <div class="form-group" style="flex: 1;">
                    <label>Data</label>
                    <input type="date" id="appt-date" required style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ccc; box-sizing: border-box;">
                </div>
                <div class="form-group" style="flex: 1;">
                    <label>Hor√°rio</label>
                    <input type="time" id="appt-time" required style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ccc; box-sizing: border-box;">
                </div>
            </div>

            <div class="form-group highlight-box assistant-card" style="margin-top: 15px;">
                <div style="display: flex; align-items: flex-start; gap: 15px;">
                    <div class="assistant-icon">üîÅ</div>
                    <div>
                        <div style="display: flex; align-items: center; justify-content: space-between; width: 100%;">
                            <label for="appt-recurrence" style="font-weight: bold; color: #1B4332; cursor: pointer; font-size: 1rem;">Repetir Semanalmente</label>
                            <label class="switch-toggle">
                                <input type="checkbox" id="appt-recurrence">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <p style="font-size: 0.85rem; color: #555; margin: 8px 0 0 0; line-height: 1.4;">
                            O agendamento se repetir√° automaticamente toda semana neste hor√°rio.
                        </p>
                    </div>
                </div>
            </div>

            <div class="form-actions" style="justify-content: flex-end; margin-top: 25px; display: flex; gap: 10px;">
                <button type="button" class="btn btn-secundario" id="cancel-appointment-modal">Cancelar</button>
                <button type="submit" class="btn btn-principal">Agendar</button>
            </div>
        </form>
    </div>
</div>

<!-- MODAL: DETALHES DA SESS√ÉO (Status e A√ß√µes) -->
<div id="modal-event-details" class="custom-modal-overlay" style="display: none;">
    <div class="custom-modal-box">
        <button class="modal-close-btn" id="close-event-modal"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
        <h3 style="margin-top: 0; color: #1B4332;">Detalhes da Sess√£o</h3>
        
        <div style="margin-bottom: 20px;">
            <h2 id="evt-patient-name" style="margin: 0; font-size: 1.4rem; color: #333;">Nome do Paciente</h2>
            <p id="evt-time-info" style="color: #666; margin: 5px 0;">Data e Hora</p>
        </div>

        <div style="background: #f9f9f9; padding: 15px; border-radius: 12px; margin-bottom: 20px;">
            <label style="display: block; font-size: 0.85rem; color: #666; margin-bottom: 8px;">Status do Atendimento:</label>
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="btn-status" data-status="done" style="flex: 1; background: #fff; border: 1px solid #ddd; padding: 10px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 5px;">
                    ‚úÖ Realizado
                </button>
                <button class="btn-status" data-status="missed" style="flex: 1; background: #fff; border: 1px solid #ddd; padding: 10px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 5px;">
                    ‚ùå Falta
                </button>
                <button class="btn-status" data-status="rescheduled" style="flex: 1; background: #fff; border: 1px solid #ddd; padding: 10px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 5px;">
                    üóìÔ∏è Reagendar
                </button>
            </div>
        </div>

        <!-- Op√ß√µes condicionais -->
        <div id="evt-options-done" style="display: none; margin-bottom: 20px;">
            <div class="form-group">
                <label>Valor Cobrado (R$)</label>
                <input type="number" id="evt-value" class="form-control" style="width: 100%; box-sizing: border-box;">
            </div>
        </div>

        <div id="evt-options-missed" style="display: none; margin-bottom: 20px;">
            <div class="form-group-checkbox" style="display: flex; align-items: center; gap: 10px;">
                <input type="checkbox" id="evt-charge-missed">
                <label for="evt-charge-missed" style="margin: 0;">Cobrar sess√£o mesmo com falta?</label>
            </div>
        </div>

        <div class="form-actions" style="justify-content: flex-end; display: flex; gap: 10px;">
            <button type="button" id="btn-save-event-status" class="btn btn-principal">Salvar Status</button>
        </div>
    </div>
</div>

<script>
    // --- L√ìGICA DO FRONTEND (MOCK) ---
    (function() {
        // Dados Mockados
        let patients = [
            { id: 1, name: 'Ana Clara Souza', phone: '(11) 99999-1111', automated: true, sessionValue: 150 },
            { id: 2, name: 'Bruno Mendes', phone: '(11) 98888-2222', automated: false, sessionValue: 200 },
            { id: 3, name: 'Carla Dias', phone: '(21) 97777-3333', automated: true, sessionValue: 180 }
        ];
        
        // Eventos com status: 'scheduled', 'done', 'missed'
        let events = [
            { id: 'e1', title: 'Ana Clara', start: '2026-01-20T10:00:00', end: '2026-01-20T11:00:00', patientId: 1, status: 'scheduled', value: 150 },
            { id: 'e2', title: 'Bruno M.', start: '2026-01-19T14:00:00', end: '2026-01-19T15:00:00', patientId: 2, status: 'done', value: 200 },
            { id: 'e3', title: 'Carla Dias', start: '2026-01-21T09:00:00', end: '2026-01-21T10:00:00', patientId: 3, status: 'scheduled', value: 180 }
        ];

        // Elementos DOM

        const listContainer = document.getElementById('patient-list');
        const countBadge = document.getElementById('patient-count');
        const searchInput = document.getElementById('search-patient');
        const modal = document.getElementById('modal-patient');
        const form = document.getElementById('form-patient');
        const pIdInput = document.getElementById('p-id');
        const btnDelete = document.getElementById('btn-delete-patient');

        // Elementos do Modal de Agendamento
        const modalAppt = document.getElementById('modal-appointment');
        const formAppt = document.getElementById('form-appointment');
        const selectPatient = document.getElementById('appt-patient');

        // Elementos Financeiros
        const modalEvent = document.getElementById('modal-event-details');
        
        // 1. Renderizar Lista
        function renderList(filter = '') {
            listContainer.innerHTML = '';
            const filtered = patients.filter(p => p.name.toLowerCase().includes(filter.toLowerCase()));
            
            countBadge.textContent = filtered.length;

            // Atualiza o select do modal de agendamento
            selectPatient.innerHTML = '<option value="">Selecione...</option>';
            patients.forEach(p => {
                const opt = document.createElement('option');
                opt.value = p.name; // Usando nome como ID simplificado
                opt.textContent = p.name;
                selectPatient.appendChild(opt);
            });

            if (filtered.length === 0) {
                listContainer.innerHTML = '<div class="empty-state-patients"><p>Nenhum paciente encontrado.</p></div>';
                return;
            }

            filtered.forEach(p => {
                // Gera iniciais para o avatar
                const initials = p.name.split(' ').map(n => n[0]).slice(0, 2).join('').toUpperCase();

                const item = document.createElement('div');
                item.className = 'patient-card';
                item.innerHTML = `
                    <div class="patient-avatar">${initials}</div>
                    <div class="patient-info">
                        <h4>${p.name}</h4>
                        <span>${p.phone}</span>
                    </div>
                    <div class="patient-status" title="${p.automated ? 'Assistente Ativa' : 'Assistente Inativa'}">
                        ${p.automated ? 'ü§ñ' : 'üîï'}
                    </div>
                    <div style="font-weight:bold; color:#1B4332; font-size:0.9rem; margin-left: 10px;">R$ ${p.sessionValue || 0}</div>
                `;
                
                // Clique no card abre edi√ß√£o
                item.onclick = () => openEditModal(p);
                
                listContainer.appendChild(item);
            });
        }

        // 2. Inicializar Calend√°rio (FullCalendar)
        function initCalendar() {
            const calendarEl = document.getElementById('calendar-wrapper');
            if (!calendarEl) return;

            const isMobile = window.innerWidth < 768;

            const calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: isMobile ? 'timeGridDay' : 'timeGridWeek', // Mobile: Dia | Desktop: Semana
                locale: 'pt-br',
                selectable: true, // Permite sele√ß√£o visual
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },
                buttonText: {
                    today: 'Hoje',
                    month: 'M√™s',
                    week: 'Semana',
                    day: 'Dia'
                },
                slotMinTime: '07:00:00',
                slotMaxTime: '22:00:00',
                allDaySlot: false,
                slotDuration: '01:00:00', // Slots de 1 hora para ficar mais limpo
                height: 'auto',
                events: events.map(evt => ({
                    ...evt,
                    color: evt.status === 'done' ? '#1B4332' : (evt.status === 'missed' ? '#d32f2f' : '#3788d8')
                })),
                // Clique em um hor√°rio vazio
                dateClick: function(info) {
                    const date = info.date;
                    // Ajusta fuso hor√°rio local para os inputs
                    const dateStr = date.toLocaleDateString('en-CA'); // YYYY-MM-DD
                    const timeStr = date.toTimeString().split(' ')[0].substring(0, 5); // HH:MM
                    
                    openAppointmentModal(dateStr, timeStr);
                },
                // Clique em um evento existente
                eventClick: function(info) {
                    openEventDetails(info.event);
                }
            });
            calendar.render();
            window.calendarApi = calendar;
        }

        // 3. Fun√ß√µes do Modal
        function openEditModal(patient) {
            form.reset();
            pIdInput.value = patient.id;
            document.getElementById('p-name').value = patient.name;
            document.getElementById('p-phone').value = patient.phone;
            document.getElementById('p-session-value').value = patient.sessionValue;
            document.getElementById('p-automated-msg').checked = patient.automated;
            
            document.getElementById('modal-patient-title').textContent = 'Editar Paciente';
            btnDelete.style.display = 'block'; // Mostra lixeira
            modal.style.display = 'flex';
        }

        function openNewPatientModal() {
            form.reset();
            pIdInput.value = ''; // Limpa ID para indicar novo
            document.getElementById('modal-patient-title').textContent = 'Novo Paciente';
            btnDelete.style.display = 'none'; // Esconde lixeira
            modal.style.display = 'flex';
        }

        function openAppointmentModal(dateStr, timeStr) {
            formAppt.reset();
            if(dateStr) document.getElementById('appt-date').value = dateStr;
            if(timeStr) document.getElementById('appt-time').value = timeStr;
            
            document.getElementById('modal-appointment-title').textContent = 'Novo Agendamento';
            modalAppt.style.display = 'flex';
        }

        document.getElementById('btn-add-patient').onclick = () => {
            form.reset();
            pIdInput.value = ''; // Limpa ID para indicar novo
            document.getElementById('modal-patient-title').textContent = 'Novo Paciente';
            btnDelete.style.display = 'none'; // Esconde lixeira
            modal.style.display = 'flex';
        };
        
        const closeModal = () => modal.style.display = 'none';
        document.getElementById('close-patient-modal').onclick = closeModal;
        document.getElementById('cancel-patient-modal').onclick = closeModal;

        const closeApptModal = () => modalAppt.style.display = 'none';
        document.getElementById('close-appointment-modal').onclick = closeApptModal;
        document.getElementById('cancel-appointment-modal').onclick = closeApptModal;

        // Fechar modais financeiros
        document.querySelectorAll('.modal-close-btn').forEach(btn => {
            btn.addEventListener('click', () => document.querySelectorAll('.custom-modal-overlay').forEach(m => m.style.display = 'none'));
        });

        // Excluir Paciente
        btnDelete.onclick = () => {
            if(confirm('Tem certeza que deseja excluir este paciente?')) {
                patients = patients.filter(p => p.id != pIdInput.value);
                renderList(searchInput.value);
                closeModal();
                if(window.showToast) window.showToast('Paciente removido.', 'success');
            }
        };

        // Salvar (Novo ou Edi√ß√£o)
        form.onsubmit = (e) => {
            e.preventDefault();
            const name = document.getElementById('p-name').value;
            const phone = document.getElementById('p-phone').value;
            const automated = document.getElementById('p-automated-msg').checked;
            const sessionValue = parseFloat(document.getElementById('p-session-value').value) || 0;
            const id = pIdInput.value;

            if (id) {
                // Edi√ß√£o
                const index = patients.findIndex(p => p.id == id);
                if (index > -1) {
                    patients[index] = { ...patients[index], name, phone, automated, sessionValue };
                    if(window.showToast) window.showToast('Dados atualizados!', 'success');
                }
            } else {
                // Novo
                patients.push({
                    id: Date.now(),
                    name,
                    phone,
                    automated,
                    sessionValue
                });
                if(window.showToast) window.showToast('Paciente adicionado com sucesso!', 'success');
            }
            
            renderList(searchInput.value);
            closeModal();
        };

        // Salvar Agendamento
        formAppt.onsubmit = (e) => {
            e.preventDefault();
            if(window.showToast) window.showToast('Agendamento realizado!', 'success');
            closeApptModal();
            // Aqui voc√™ adicionaria o evento ao calend√°rio via calendar.addEvent()
        };

        // --- L√ìGICA DE DETALHES DO EVENTO ---
        let currentEventId = null;
        function openEventDetails(fcEvent) {
            const evt = events.find(e => e.id == fcEvent.id);
            if(!evt) return;
            
            currentEventId = evt.id;
            document.getElementById('evt-patient-name').textContent = evt.title;
            document.getElementById('evt-time-info').textContent = new Date(evt.start).toLocaleString('pt-BR');
            document.getElementById('evt-value').value = evt.value;
            
            // Reset UI
            document.querySelectorAll('.btn-status').forEach(b => {
                b.style.background = '#fff'; b.style.color = '#333'; b.style.borderColor = '#ddd';
            });
            document.getElementById('evt-options-done').style.display = 'none';
            document.getElementById('evt-options-missed').style.display = 'none';

            // Seleciona status atual se houver
            if(evt.status) {
                const btn = document.querySelector(`.btn-status[data-status="${evt.status}"]`);
                if(btn) highlightStatusBtn(btn, evt.status);
                if(evt.status === 'done') document.getElementById('evt-options-done').style.display = 'block';
                if(evt.status === 'missed') document.getElementById('evt-options-missed').style.display = 'block';
            }

            modalEvent.style.display = 'flex';
        }

        function highlightStatusBtn(btn, status) {
            if(status === 'done') { btn.style.background = '#e8f5e9'; btn.style.borderColor = '#1B4332'; btn.style.color = '#1B4332'; }
            if(status === 'missed') { btn.style.background = '#ffebee'; btn.style.borderColor = '#d32f2f'; btn.style.color = '#d32f2f'; }
            if(status === 'rescheduled') { btn.style.background = '#fff3e0'; btn.style.borderColor = '#f57c00'; btn.style.color = '#f57c00'; }
        }

        document.querySelectorAll('.btn-status').forEach(btn => {
            btn.onclick = () => {
                const status = btn.dataset.status;
                document.querySelectorAll('.btn-status').forEach(b => {
                    b.style.background = '#fff'; b.style.color = '#333'; b.style.borderColor = '#ddd';
                });
                highlightStatusBtn(btn, status);
                document.getElementById('evt-options-done').style.display = status === 'done' ? 'block' : 'none';
                document.getElementById('evt-options-missed').style.display = status === 'missed' ? 'block' : 'none';
            };
        });

        document.getElementById('btn-save-event-status').onclick = () => {
            const activeBtn = document.querySelector('.btn-status[style*="background"]');
            if(!activeBtn) return;
            
            const status = activeBtn.dataset.status;
            const evtIdx = events.findIndex(e => e.id == currentEventId);
            
            if(evtIdx > -1) {
                events[evtIdx].status = status;
                if(status === 'done') {
                    events[evtIdx].value = parseFloat(document.getElementById('evt-value').value);
                }
                const fcEvent = window.calendarApi.getEventById(currentEventId);
                if(fcEvent) {
                    fcEvent.setProp('color', status === 'done' ? '#1B4332' : (status === 'missed' ? '#d32f2f' : '#3788d8'));
                }
            }
            modalEvent.style.display = 'none';
            if(window.showToast) window.showToast('Status atualizado!', 'success');
        };


        searchInput.oninput = (e) => renderList(e.target.value);

        // Inicializa√ß√£o
        renderList();
        // Pequeno delay para garantir que o DOM renderizou o container do calend√°rio
        setTimeout(initCalendar, 100);

        // M√°scara de telefone (se IMask estiver dispon√≠vel)
        if (typeof IMask !== 'undefined') {
            IMask(document.getElementById('p-phone'), { mask: '(00) 00000-0000' });
        }
    })();
</script>

<style>
    /* Estilos Locais Espec√≠ficos (Complemento ao CSS Global) */
    
    /* Ajuste do Modal de Paciente (Mais largo para alinhar inputs) */
    #modal-patient .custom-modal-box {
        max-width: 800px;
    }

    /* Bot√µes de Status */
    .btn-status { transition: all 0.2s; font-weight: 600; font-size: 0.9rem; }
    .btn-status:hover { transform: translateY(-2px); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    
    /* --- MOBILE FIRST (Padr√£o) --- */
    .patients-layout-grid {
        display: grid;
        grid-template-columns: 1fr; /* 1 Coluna empilhada */
        gap: 20px;
        height: auto; /* Altura cresce com conte√∫do */
        padding-bottom: 60px; /* Espa√ßo extra no fundo para mobile */
    }

    /* Ajuste do Card para Mobile e Clique */
    .patient-card {
        cursor: pointer; /* Indica que √© clic√°vel */
        user-select: none;
    }

    .patient-list-container {
        /* No mobile, limitamos a altura da lista para n√£o empurrar o calend√°rio para fora da tela */
        max-height: 350px; 
        overflow-y: auto;
        padding-right: 5px;
    }

    .calendar-legend {
        display: flex;
        gap: 15px;
        font-size: 0.85rem;
        color: #666;
        flex-wrap: wrap; /* Permite quebrar linha em telas pequenas */
    }
    .legend-item { display: flex; align-items: center; gap: 5px; }
    .dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; }
    .dot.available { background-color: #fff; border: 2px solid #1B4332; }
    .dot.busy { background-color: #e0e0e0; }

    /* Ajuste do Modal no Mobile */
    .custom-modal-box {
        max-height: 90vh;
        overflow-y: auto;
    }

    /* Header dos Widgets (Estilo Refinado) */
    .widget-header-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid #f0f0f0;
    }
    .widget-title {
        margin: 0;
        font-size: 1.1rem;
        color: #1B4332;
        font-weight: 700;
    }
    .badge-count {
        background-color: #e8f5e9;
        color: #1B4332;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: 800;
    }

    /* Bot√£o Hoje do Calend√°rio (Contraste e Estado) */
    .fc .fc-today-button {
        background-color: #1B4332 !important;
        border-color: #1B4332 !important;
        color: #fff !important;
        font-weight: 700 !important;
        opacity: 1 !important;
        text-transform: capitalize;
        transition: all 0.2s ease;
    }
    /* Quando desabilitado (Indica que j√° estamos no dia atual) */
    .fc .fc-today-button:disabled {
        background-color: #FFEE8C !important; /* Amarelo Yelo */
        border-color: #FFEE8C !important;
        color: #1B4332 !important; /* Texto Verde */
        cursor: default;
        box-shadow: none;
    }

    /* --- ESTILOS MODERNOS DO CALEND√ÅRIO --- */
    .fc-theme-standard td, .fc-theme-standard th {
        border-color: #f0f0f0;
    }
    .fc-timegrid-slot {
        height: 3.5em !important; /* Slots mais altos para melhor clique */
        border-bottom: 1px solid #f9f9f9 !important;
    }
    /* Feedback visual ao passar o mouse no hor√°rio */
    .fc-timegrid-slot-lane:hover {
        background-color: rgba(27, 67, 50, 0.04);
        cursor: pointer;
        transition: background-color 0.2s;
    }
    .fc-col-header-cell {
        background-color: #f9fafb;
        padding: 12px 0;
        border-bottom: none;
    }
    .fc-col-header-cell-cushion {
        color: #555;
        font-weight: 700;
        text-transform: uppercase;
        font-size: 0.8rem;
        letter-spacing: 0.5px;
    }
    .fc-event {
        border-radius: 6px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        border: none;
        padding: 2px 4px;
        font-weight: 600;
    }

    /* Estilo do Card Assistente */
    .assistant-card {
        background: linear-gradient(135deg, #f0fdf4 0%, #e6fffa 100%);
        border: 1px solid #bbf7d0;
        border-radius: 16px;
        padding: 20px;
        transition: transform 0.2s;
    }
    .assistant-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(27, 67, 50, 0.05);
    }
    .assistant-icon {
        font-size: 1.8rem;
        background: #fff;
        width: 45px;
        height: 45px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }

    /* Toggle Switch */
    .switch-toggle {
        position: relative;
        display: inline-block;
        width: 44px;
        height: 24px;
        margin-left: 10px;
    }
    .switch-toggle input { opacity: 0; width: 0; height: 0; }
    .slider {
        position: absolute;
        cursor: pointer;
        top: 0; left: 0; right: 0; bottom: 0;
        background-color: #ccc;
        transition: .4s;
        border-radius: 24px;
    }
    .slider:before {
        position: absolute;
        content: "";
        height: 18px;
        width: 18px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    input:checked + .slider { background-color: #1B4332; }
    input:checked + .slider:before { transform: translateX(20px); }

    /* Ajuste para gr√°ficos no mobile */
    @media (max-width: 768px) {
        .fin-charts-row { grid-template-columns: 1fr !important; }
    }

    /* --- DESKTOP (Telas maiores que 992px) --- */
    @media (min-width: 992px) {
        .patients-layout-grid { 
            grid-template-columns: 450px 1fr; /* Aumentado para 450px para evitar cards espremidos */
            gap: 25px;
            height: calc(100vh - 160px); /* Altura fixa para scroll independente */
            padding-bottom: 0;
        }
        
        .widget { 
            height: 100%; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden; /* Cont√©m o scroll dentro do widget */
        }

        .patient-list-container {
            max-height: none; /* Remove limite de altura */
            flex-grow: 1;     /* Ocupa todo espa√ßo vertical dispon√≠vel */
        }
        
        #calendar-wrapper {
            flex-grow: 1;
            overflow-y: auto;
        }
    }
</style>