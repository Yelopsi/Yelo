<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil do Psic√≥logo - Yelo</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@500;600;700&family=Mulish:wght@400;500;600&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="/css/01-variables.css"> 
    <link rel="stylesheet" href="/css/02-base.css">      
    <link rel="stylesheet" href="/css/03-layout.css">    
    <link rel="stylesheet" href="/css/04-components.css"> 

    <link rel="stylesheet" href="/css/psi_dashboard.css">
    
    <style>
        :root {
            --fonte-titulo: 'Lora', serif;
            --fonte-corpo: 'Mulish', sans-serif;
        }
        body {
            font-family: var(--fonte-corpo);
        }
        h1, h2, h3, h4, h5, h6 {
            font-family: var(--fonte-titulo);
            font-weight: 600;
        }
        /* Estilos Espec√≠ficos Modernos para o Perfil P√∫blico */
        body {
            background-color: #FFFDF5; /* Fundo creme suave da marca */
            overflow-x: hidden; /* IMPEDE ROLAGEM HORIZONTAL INDESEJADA */
            width: 100%;
            max-width: 100vw;
        }
        html { overflow-x: hidden; }

        .profile-layout-grid {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 40px;
            margin-top: 40px;
            align-items: start;
        }

        /* Coluna Esquerda (Conte√∫do) */
        .profile-hero-card {
            background: white;
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.03);
            border: 1px solid rgba(0,0,0,0.05);
            margin-bottom: 30px;
            position: relative;
        }

        .profile-header-flex {
            display: flex;
            gap: 30px;
            align-items: flex-start;
        }

        .profile-photo-wrapper {
            flex-shrink: 0;
            width: 140px;
            height: 140px;
            border-radius: 50%;
            overflow: hidden;
            border: 4px solid #FFEE8C; /* Amarelo Yelo */
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }

        .profile-photo-wrapper img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-name-block h1 {
            font-family: var(--fonte-titulo);
            color: #1B4332;
            font-size: 2.2rem;
            margin: 0 0 5px 0;
            line-height: 1.1;
        }

        .crp-badge {
            display: inline-block;
            background: #f0fdf4;
            color: #166534;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        /* Tags de Especialidades */
        .tags-container {
            display: flex;
            flex-direction: column; /* Um embaixo do outro */
            gap: 8px;
            margin-top: 15px;
        }
        .tag-pill {
            background: #f3f4f6;
            color: #4b5563;
            padding: 6px 14px;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        /* Bot√£o de Favorito (Cora√ß√£o) */
        .btn-favorite {
            background: white;
            border: 1px solid #e5e7eb;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #d1d5db; /* Cinza desativado */
            flex-shrink: 0;
        }
        .btn-favorite:hover { transform: scale(1.1); border-color: #fca5a5; }
        .btn-favorite.active {
            color: #ef4444; /* Vermelho */
            background-color: #fef2f2;
            border-color: #fecaca;
        }
        .btn-favorite svg { width: 24px; height: 24px; fill: currentColor; }

        /* NOVO: Estilo padr√£o para a linha do cabe√ßalho (Desktop) */
        .name-header-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        /* Estrelas Clic√°veis */
        .hero-stars-container {
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .hero-stars-container:hover { opacity: 0.7; }

        /* Coluna Direita (Sticky) */
        .sticky-sidebar {
            position: sticky;
            top: 100px; /* Ajuste conforme a altura do seu header fixo */
        }

        .conversion-card-modern {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(27, 67, 50, 0.08);
            border: 1px solid rgba(27, 67, 50, 0.1);
            text-align: center;
        }

        .price-display {
            font-family: var(--fonte-titulo);
            font-size: 2.5rem;
            color: #1B4332;
            margin: 10px 0;
        }
        .price-display span {
            font-family: var(--fonte-corpo);
            font-size: 1rem;
            color: #666;
            font-weight: 400;
        }
        .price-suffix {
            font-size: 0.9rem;
            color: #888;
            display: block;
            line-height: 1;
        }

        .info-row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            color: #555;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        @media (max-width: 992px) {
            .profile-layout-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            .profile-header-flex {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }
            .profile-hero-card {
                padding: 25px 20px; /* Padding reduzido no mobile */
            }
            .profile-photo-wrapper {
                width: 120px; /* Foto um pouco menor */
                height: 120px;
            }
            .profile-name-block h1 {
                font-size: 1.8rem; /* T√≠tulo ajustado */
            }
            .sticky-sidebar {
                position: static;
                order: -1; /* No mobile, o card de agendamento pode vir antes ou logo depois do hero */
            }
            .conversion-card-modern {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                width: 100%;
                max-width: 100vw;
                box-sizing: border-box;
                border-radius: 20px 20px 0 0;
                z-index: 100;
                padding: 15px 20px;
                box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
                display: flex;
                justify-content: space-between;
                align-items: center;
                text-align: left;
            }
            .conversion-card-modern h3, .conversion-card-modern .info-row, .conversion-card-modern #psi-localizacao-container {
                display: none !important; /* Simplifica no mobile */
            }
            .conversion-card-modern .price-display {
                font-size: 2rem !important;
                margin: 0;
                text-align: left;
            }
            .price-display span {
                font-size: 0.8rem;
                display: block; /* Coloca "por sess√£o" embaixo do pre√ßo */
                line-height: 1;
            }
            .price-suffix {
                font-size: 0.75rem;
                margin-top: 0;
            }
            .btn-principal {
                width: auto !important;
                padding: 7px 8px;
                font-size: 0.8rem;
            }
            /* Ajuste para o conte√∫do n√£o ficar escondido atr√°s do card fixo no mobile */
            body { padding-bottom: 100px; }
            /* Mostra o bloco de info mobile */
            .mobile-service-info { display: block !important; }
            
            /* Esconde badges de confian√ßa no mobile para economizar espa√ßo */
            .trust-badges-row { display: none !important; }
            
            /* Ajuste da anima√ß√£o no mobile (menos intensa) */
            @keyframes pulse-green-mobile {
                0% { box-shadow: 0 0 0 0 rgba(27, 67, 50, 0.4); }
                70% { box-shadow: 0 0 0 6px rgba(27, 67, 50, 0); }
                100% { box-shadow: 0 0 0 0 rgba(27, 67, 50, 0); }
            }
            .btn-pulse { animation-name: pulse-green-mobile !important; }

            /* --- NOVOS AJUSTES MOBILE (SOLICITADOS) --- */
            .verified-badge-mobile {
                display: flex !important;
                align-items: center;
                justify-content: center;
                gap: 6px;
                margin-bottom: 15px;
                color: #1B4332;
                font-size: 0.85rem;
                font-weight: 600;
                background-color: #e8f5e9;
                padding: 5px 15px;
                border-radius: 20px;
                width: fit-content;
                margin-left: auto;
                margin-right: auto;
            }
            
            /* Reorganiza√ß√£o do Topo */
            .profile-name-block {
                display: flex;
                flex-direction: column;
                align-items: center;
                width: 100%;
            }
            
            /* Ajuste para centralizar Nome, CRP e √çcones */
            .name-header-row {
                display: flex;
                flex-direction: column;
                align-items: center;
                width: 100%;
            }

            /* Nome e CRP */
            .name-info-wrapper {
                display: flex;
                flex-direction: column-reverse; /* Nome em cima, CRP embaixo */
                align-items: center;
                text-align: center;
                margin-bottom: 10px;
            }
            
            /* Estrelas */
            #hero-rating-display {
                justify-content: center !important;
                margin-bottom: 15px !important;
            }

            /* Bot√µes de A√ß√£o (Share/Fav) */
            .header-actions {
                justify-content: center;
                margin-bottom: 15px;
                width: 100%;
                display: flex;
                gap: 10px !important;
            }

            .header-actions .btn-favorite {
                width: 36px;
                height: 36px;
            }
            .header-actions .btn-favorite svg { width: 18px; height: 18px; }

            /* Redes Sociais e Tags */
            #psi-social-links { justify-content: center !important; }
            #psi-tags-display { justify-content: center; }

            /* Esconde o texto de verificado do rodap√© */
            .footer-verified-text { display: none !important; }
            
            /* Oculta √≠cone do bot√£o no mobile para economizar espa√ßo */
            #btn-agendar-whatsapp svg { display: none; }
            
            /* Ajuste do Bot√£o Agendar no Rodap√© */
            .conversion-card-modern {
                padding: 10px;
                gap: 8px;
            }
            .btn-principal {
                flex-grow: 1; /* Ocupa o espa√ßo dispon√≠vel */
                margin: 0;
                white-space: nowrap;
            }

            /* Remove a Bottom Nav desta p√°gina no mobile */
            .mobile-bottom-nav, .bottom-nav { display: none !important; }
        }

        /* --- ANIMA√á√ÉO DE PULSO (CONVERS√ÉO) --- */
        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(27, 67, 50, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(27, 67, 50, 0); }
            100% { box-shadow: 0 0 0 0 rgba(27, 67, 50, 0); }
        }
        .btn-pulse {
            animation: pulse-green 2s infinite;
        }

        /* --- ESTILOS MODERNOS PARA AVALIA√á√ïES --- */
        .reviews-summary {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            padding-bottom: 25px;
            border-bottom: 1px solid #f0f0f0;
        }
        .summary-avg-rating {
            font-family: var(--fonte-titulo);
            font-size: 2.8rem;
            color: #333;
            line-height: 1;
        }
        .summary-stars {
            color: #FFC107;
            font-size: 1.2rem;
        }
        .summary-count {
            color: #777;
            font-size: 0.9rem;
        }

        .review-card {
            padding: 20px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        #reviews-list-container .review-card:last-of-type {
            border-bottom: none;
        }
        .review-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }
        .review-avatar {
            width: 48px; /* Levemente maior para apreciar os detalhes */
            height: 48px;
            border-radius: 50%;
            overflow: hidden; /* Garante que o SVG fique redondo */
            flex-shrink: 0;
            background-color: #f0f0f0; /* Fallback sutil */
        }
        .review-avatar svg { width: 100%; height: 100%; display: block; }
        
        .review-author-name { font-weight: 600; color: #333; }
        .review-date { font-size: 0.8rem; color: #888; display: block; }
        .review-rating { color: #FFC107; font-size: 0.9rem; margin-bottom: 10px; }
        .review-comment { color: #555; font-size: 0.95rem; line-height: 1.6; margin: 0; }

        .btn-show-more {
            display: block;
            width: fit-content;
            margin: 30px auto 0 auto;
            padding: 10px 25px;
            border: 1px solid #ccc;
            background: #fff;
            color: #333;
            font-weight: 600;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-show-more:hover { background: #f5f5f5; border-color: #999; }

        /* Badges de Confian√ßa (Desktop) */
        .trust-badges-row {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #f0f0f0;
        }
        .trust-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.8rem;
            color: #666;
            font-weight: 500;
        }
        .trust-item svg {
            width: 16px;
            height: 16px;
            color: var(--verde-escuro);
        }

        /* --- GAMIFICATION BADGES (CSS ARTS) --- */
        .badges-wrapper {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .badge-item {
            display: inline-flex;
            align-items: center;
            justify-content: center; /* Centraliza o emoji */
            width: 32px; /* Tamanho fixo */
            height: 32px; /* Tamanho fixo */
            border-radius: 50%; /* C√≠rculo */
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: transform 0.2s;
            cursor: default;
        }
        .badge-item:hover { transform: translateY(-2px); }

        /* Cores dos N√≠veis */
        .badge-bronze {
            background: linear-gradient(135deg, #FFF0E0, #FFE0B2);
            border: 1px solid #FFCC80;
            color: #8D6E63;
        }
        .badge-prata {
            background: linear-gradient(135deg, #F5F5F5, #E0E0E0);
            border: 1px solid #BDBDBD;
            color: #616161;
        }
        .badge-ouro {
            background: linear-gradient(135deg, #FFFDE7, #FFF59D);
            border: 1px solid #FDD835;
            color: #F57F17;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }
        /* Badges Especiais */
        .badge-autentico {
            background: linear-gradient(135deg, #E8F5E9, #C8E6C9);
            border: 1px solid #81C784;
            color: #2E7D32;
        }
        .badge-pioneiro {
            background: linear-gradient(135deg, #F3E5F5, #E1BEE7);
            border: 1px solid #BA68C8;
            color: #7B1FA2;
        }
        
        .badge-icon { font-size: 18px; line-height: 1; } /* Tamanho do emoji */
    </style>
</head>
<body>

    <%- include('partials/header') %>

    <div id="loading-state" class="container" style="text-align: center; padding: 5rem 1rem;">
        <h2>Carregando...</h2>
        <p>Buscando as informa√ß√µes do profissional.</p>
    </div>

    <div id="error-state" class="container hidden" style="text-align: center; padding: 5rem 1rem;">
        <h2>Perfil Indispon√≠vel</h2>
        <p>N√£o foi poss√≠vel carregar os dados deste profissional no momento.</p>
    </div>

    <main id="profile-container" class="profile-page-main hidden">
        <div class="container">
            
            <!-- Bot√£o Voltar (Navega√ß√£o) -->
            <div style="margin-bottom: 20px;">
                <a href="javascript:history.back()" style="display: inline-flex; align-items: center; gap: 8px; color: #666; text-decoration: none; font-weight: 600; font-size: 0.95rem; transition: color 0.2s;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                    Voltar
                </a>
            </div>

            <div class="profile-layout-grid">
                
                <!-- COLUNA ESQUERDA: Informa√ß√µes Principais -->
                <div class="left-column">
                    <div class="profile-hero-card">
                        <!-- Selo Verificado (Apenas Mobile) -->
                        <div class="verified-badge-mobile" style="display: none;">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
                            <span>Profissional verificado</span>
                        </div>

                        <div class="profile-header-flex">
                            <div class="profile-photo-wrapper">
                                <img id="psi-foto" src="" alt="Foto do Psic√≥logo">
                            </div>
                            <div class="profile-name-block" style="flex-grow: 1;">
                                <div class="name-header-row">
                                    <div class="name-info-wrapper">
                                        <span id="psi-crp" class="crp-badge">CRP: --/------</span>
                                        <h1 id="psi-nome">Carregando...</h1>
                                    </div>
                                    <div class="header-actions" style="display: flex; gap: 10px;">
                                        <button id="btn-share" class="btn-favorite" title="Compartilhar Perfil">
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" id="Ios-Share--Streamline-Outlined-Material" height="24" width="24"><desc>Ios Share Streamline Icon: https://streamlinehq.com</desc><path fill="currentColor" d="M5.5 23c-0.4 0 -0.75 -0.15 -1.05 -0.45 -0.3 -0.3 -0.45 -0.65 -0.45 -1.05V8.775c0 -0.4 0.15 -0.75 0.45 -1.05 0.3 -0.3 0.65 -0.45 1.05 -0.45h4.225v1.5H5.5V21.5h13V8.775h-4.275v-1.5H18.5c0.4 0 0.75 0.15 1.05 0.45 0.3 0.3 0.45 0.65 0.45 1.05V21.5c0 0.4 -0.15 0.75 -0.45 1.05 -0.3 0.3 -0.65 0.45 -1.05 0.45H5.5Zm5.725 -7.675V3.9l-2.2 2.2 -1.075 -1.075L11.975 1 16 5.025l-1.075 1.075 -2.2 -2.2v11.425h-1.5Z" stroke-width="0.5"></path></svg>
                                        </button>
                                        <button id="btn-favorite" class="btn-favorite" title="Favoritar este profissional">
                                            <svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                                        </button>
                                    </div>
                                </div>
                                
                                <div id="hero-rating-display" class="hero-stars-container" style="justify-content: flex-start; margin-bottom: 15px;"></div>
                                
                                <div id="psi-social-links" class="social-links-profile" style="justify-content: flex-start;"></div>
                                
                                <!-- Container para Tags (Preenchido via JS se houver l√≥gica, ou adicione l√≥gica no JS para preencher aqui) -->
                                <div id="psi-tags-display" class="tags-container">
                                    <!-- Exemplo est√°tico de como ficar√° -->
                                    <!-- <span class="tag-pill">Ansiedade</span> -->
                                </div>

                                <!-- LOCAL DAS BADGES -->
                                <div id="psi-badges-display" class="badges-wrapper"></div>
                            </div>
                        </div>

                        <div class="profile-bio-hero" style="margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px;">
                            <h3 class="titulo-bio" style="font-family: var(--fonte-titulo); color: #1B4332;">Sobre Mim</h3>
                            <p id="psi-bio-text" style="line-height: 1.8; color: #444;"></p>
                        </div>
                    </div>

                    <!-- BLOCO EXCLUSIVO MOBILE: Informa√ß√µes de Atendimento -->
                    <!-- Como o card lateral vira rodap√© fixo e esconde detalhes, mostramos aqui -->
                    <div class="mobile-service-info" style="display: none; background: white; padding: 20px; border-radius: 16px; margin-bottom: 30px; border: 1px solid #eee; box-shadow: 0 4px 15px rgba(0,0,0,0.03);">
                        <h3 style="margin-top: 0; color: #1B4332; font-size: 1.1rem; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 15px;">Informa√ß√µes de Atendimento</h3>
                        
                        <div class="info-row" style="justify-content: flex-start; margin-bottom: 12px;">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                            <span id="psi-modalidade-mobile">Online e Presencial</span>
                        </div>
                        
                        <div id="psi-localizacao-container-mobile" class="info-row" style="display: none; justify-content: flex-start; margin-bottom: 12px;">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 21h18M5 21V7l8-4 8 4v14M8 21v-4h8v4"></path></svg>
                            <span id="psi-cidade-estado-mobile"></span>
                        </div>

                        <div class="info-row" style="justify-content: flex-start;">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                            <span id="psi-disponibilidade-mobile">Consulte hor√°rios</span>
                        </div>
                    </div>

                    <!-- Se√ß√£o Detalhes Profissionais -->
                    <div class="profile-section" style="margin-bottom: 50px;">
                        <h3 style="font-family: var(--fonte-titulo); color: #1B4332; font-size: 1.5rem; border-bottom: 1px solid #eee; padding-bottom: 15px; margin-bottom: 25px;">Detalhes Profissionais</h3>
                        
                        <div id="tab-sobre">
                            <!-- O JS preenche aqui -->
                        </div>
                    </div>

                    <!-- Se√ß√£o Avalia√ß√µes -->
                    <div id="tab-avaliacoes" class="profile-section">
                        <h3 style="font-family: var(--fonte-titulo); color: #1B4332; font-size: 1.5rem; border-bottom: 1px solid #eee; padding-bottom: 15px; margin-bottom: 25px;">Avalia√ß√µes de Pacientes</h3>
                        
                        <div id="reviews-list-container" style="margin-bottom: 40px;">
                            <p style="text-align: center; color: #777;">Nenhuma avalia√ß√£o ainda.</p>
                        </div>

                        <div class="review-form-box" style="background: #f9fafb; padding: 30px; border-radius: 16px; border: 1px solid #eee;">
                            <h4 style="margin-top: 0; color: #1B4332; font-size: 1.2rem; margin-bottom: 10px;">Quer deixar uma avalia√ß√£o?</h4>
                            <p style="color: #666; font-size: 0.95rem; margin-bottom: 20px;">Conte como foi sua experi√™ncia. Seu feedback √© an√¥nimo e ajuda outras pessoas a encontrarem o profissional ideal.</p>
                            
                            <form id="form-nova-avaliacao">
                                <div class="star-rating-input" style="margin-bottom: 15px;">
                                    <input type="radio" id="star5" name="rating" value="5" /><label for="star5" title="Excelente">‚òÖ</label>
                                    <input type="radio" id="star4" name="rating" value="4" /><label for="star4" title="Muito bom">‚òÖ</label>
                                    <input type="radio" id="star3" name="rating" value="3" /><label for="star3" title="Bom">‚òÖ</label>
                                    <input type="radio" id="star2" name="rating" value="2" /><label for="star2" title="Regular">‚òÖ</label>
                                    <input type="radio" id="star1" name="rating" value="1" /><label for="star1" title="Ruim">‚òÖ</label>
                                </div>
                                <textarea name="comentario" class="comment-input-capsule" placeholder="Escreva aqui sua avalia√ß√£o (Opcional)..." rows="1"></textarea>
                                <button type="submit" class="btn btn-verde" style="margin-top: 15px;">Enviar Avalia√ß√£o</button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- COLUNA DIREITA: Card de Convers√£o (Sticky) -->
                <aside class="sticky-sidebar">
                    <div class="conversion-card-modern">
                        <h3 style="margin: 0; color: #666; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px;">Valor da Sess√£o</h3>
                        <div>
                            <div id="psi-valor" class="price-display">Sob Consulta</div>
                            <span class="price-suffix">por sess√£o</span>
                        </div>
                        
                        <div style="margin: 20px 0; border-top: 1px solid #eee; border-bottom: 1px solid #eee; padding: 15px 0;">
                            <div class="info-row">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                                <span id="psi-modalidade">Online e Presencial</span>
                            </div>
                            
                            <div id="psi-localizacao-container" class="info-row" style="display: none;">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 21h18M5 21V7l8-4 8 4v14M8 21v-4h8v4"></path></svg>
                                <span id="psi-cidade-estado"></span>
                            </div>

                            <div class="info-row">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                                <span id="psi-disponibilidade">Consulte hor√°rios</span>
                            </div>
                        </div>

                        <a href="#" id="btn-agendar-whatsapp" target="_blank" class="btn btn-principal btn-pulse" style="width: 100%; display: flex; justify-content: center; align-items: center; gap: 10px; padding: 15px;">
                            <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor"><path d="M13.601 2.326A7.854 7.854 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.933 7.933 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.898 7.898 0 0 0 13.6 2.326zM7.994 14.521a6.573 6.573 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.557 6.557 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592zm3.615-4.934c-.197-.099-1.17-.578-1.353-.646-.182-.068-.315-.099-.445.099-.133.197-.513.646-.627.775-.114.133-.232.148-.43.05-.197-.1-.836-.308-1.592-.985-.59-.525-.985-1.175-1.103-1.372-.114-.198-.011-.304.088-.403.087-.088.197-.232.296-.346.1-.114.133-.198.198-.33.065-.134.034-.248-.015-.347-.05-.099-.445-1.076-.612-1.47-.16-.389-.323-.335-.445-.34-.114-.007-.247-.007-.38-.007a.729.729 0 0 0-.529.247c-.182.198-.691.677-.691 1.654 0 .977.71 1.916.81 2.049.098.133 1.394 2.132 3.383 2.992.47.205.84.326 1.129.418.475.152.904.129 1.246.08.38-.058 1.171-.48 1.338-.943.164-.464.164-.86.114-.943-.049-.084-.182-.133-.38-.232z"/></svg>
                            Agendar Sess√£o
                        </a>
                        
                        <div class="trust-badges-row footer-verified-text">
                            <div class="trust-item">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
                                <span>CRP Ativo</span>
                            </div>
                            <div class="trust-item">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
                                <span>Sigilo Garantido</span>
                            </div>
                        </div>
                    </div>
                </aside>

            </div>
        </div>
    </main>

    <%- include('partials/footer') %>
    
    <div id="toast-container"></div>

    <!-- Modal Login Necess√°rio (Avalia√ß√£o) -->
    <div id="modal-login-required" class="custom-modal-overlay" style="display: none;">
        <div class="custom-modal-box">
            <h3 style="margin-top: 0; color: #1B4332; font-family: 'Fraunces', serif;">Login Necess√°rio</h3>
            <p style="color: #666; margin-bottom: 25px; line-height: 1.5;">Para garantir a qualidade das avalia√ß√µes, precisamos que voc√™ se identifique. √â rapidinho!</p>
            <div style="display: flex; gap: 10px; justify-content: flex-end; flex-wrap: wrap;">
                <button id="btn-modal-stay" style="padding: 10px 20px; background: #fff; border: 1px solid #ddd; border-radius: 8px; cursor: pointer; font-weight: 600; color: #555;">Continuar na p√°gina</button>
                <a id="btn-modal-login" href="#" style="padding: 10px 20px; background: #1B4332; color: #fff; border: none; border-radius: 8px; font-weight: bold; text-decoration: none; display: inline-block; text-align: center;">Entrar ou Cadastrar</a>
            </div>
        </div>
    </div>

    <!-- Modal Login Necess√°rio (Favoritar) -->
    <div id="modal-login-favorite" class="custom-modal-overlay" style="display: none;">
        <div class="custom-modal-box">
            <h3 style="margin-top: 0; color: #1B4332; font-family: 'Fraunces', serif;">Fa√ßa login para favoritar</h3>
            <p style="color: #666; margin-bottom: 15px; line-height: 1.5;">
                Para adicionar este psic√≥logo aos seus favoritos, √© necess√°rio acessar sua conta.
            </p>
            <p style="color: #666; margin-bottom: 15px; line-height: 1.5;">
                No seu painel, voc√™ poder√° ver tanto os <strong>favoritos</strong> como os <strong>matches</strong> que teve.
            </p>
            <div style="background-color: #e0f2f1; padding: 12px; border-radius: 8px; margin-bottom: 20px; font-size: 0.9rem; color: #004d40; display: flex; gap: 10px; align-items: flex-start;">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink: 0; margin-top: 2px;"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                <span>N√£o se preocupe! Voc√™ ser√° redirecionado automaticamente para c√° e o profissional j√° estar√° favoritado ao finalizar o cadastro.</span>
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end; flex-wrap: wrap;">
                <button id="btn-modal-fav-cancel" style="padding: 10px 20px; background: #fff; border: 1px solid #ddd; border-radius: 8px; cursor: pointer; font-weight: 600; color: #555;">Cancelar</button>
                <a id="btn-modal-fav-login" href="#" style="padding: 10px 20px; background: #1B4332; color: #fff; border: none; border-radius: 8px; font-weight: bold; text-decoration: none; display: inline-block; text-align: center;">Criar conta / Entrar</a>
            </div>
        </div>
    </div>

    <script src="/config.js"></script>
    
    <script src="/script.js"></script>

    <script src="/perfil_psicologo.js"></script> 

    <script>
        // --- FUN√á√ÉO PARA RENDERIZAR BADGES (Injetada via Script Inline ou movida para perfil_psicologo.js) ---
        function renderBadges(badgesData) {
            const container = document.getElementById('psi-badges-display');
            if (!container || !badgesData) return;

            let html = '';

            // 1. Badge Aut√™ntico (Seguran√ßa)
            if (badgesData.autentico) {
                html += `
                    <div class="badge-item badge-autentico" title="Aut√™ntico: Este profissional mant√©m o perfil 100% completo e verificado.">
                        <span class="badge-icon">üõ°Ô∏è</span>
                    </div>
                `;
            }

            // 2. Badge Semeador (Conte√∫do)
            if (badgesData.semeador) {
                const nivel = badgesData.semeador; // bronze, prata, ouro
                const label = nivel.charAt(0).toUpperCase() + nivel.slice(1);
                html += `
                    <div class="badge-item badge-${nivel}" title="Semeador (${label}): Produz conte√∫do e educa a audi√™ncia na plataforma.">
                        <span class="badge-icon">üå±</span>
                    </div>
                `;
            }

            // 3. Badge Voz Ativa (Comunidade)
            if (badgesData.voz_ativa) {
                const nivel = badgesData.voz_ativa;
                const label = nivel.charAt(0).toUpperCase() + nivel.slice(1);
                html += `
                    <div class="badge-item badge-${nivel}" title="Voz Ativa (${label}): Acolhe e responde d√∫vidas de pacientes na Comunidade Yelo.">
                        <span class="badge-icon">üí¨</span>
                    </div>
                `;
            }

            // 4. Badge Pioneiro
            if (badgesData.pioneiro) {
                html += `
                    <div class="badge-item badge-pioneiro" title="Pioneiro: Membro Fundador, um dos primeiros profissionais da Yelo.">
                        <span class="badge-icon">üèÖ</span>
                    </div>
                `;
            }

            container.innerHTML = html;
        }

        document.addEventListener('DOMContentLoaded', () => {
            // L√≥gica para o bot√£o de compartilhar
            const btnShare = document.getElementById('btn-share');
            if (btnShare) {
                btnShare.addEventListener('click', async () => {
                    if (navigator.share) {
                        try {
                            await navigator.share({
                                title: document.title,
                                url: window.location.href
                            });
                        } catch (err) { console.log('Erro ao compartilhar:', err); }
                    } else {
                        navigator.clipboard.writeText(window.location.href).then(() => {
                            alert('Link do perfil copiado!');
                        });
                    }
                });
            }

            // L√≥gica de Rastreamento de KPI (Cliques no WhatsApp)
            const btnWhatsapp = document.getElementById('btn-agendar-whatsapp');
            if (btnWhatsapp) {
                btnWhatsapp.addEventListener('click', () => {
                    // 1. Extra√ß√£o mais segura do slug (evita erro com barra no final)
                    const pathParts = window.location.pathname.split('/').filter(p => p);
                    const slug = pathParts.length > 0 ? pathParts[pathParts.length - 1] : null;
                    
                    if (slug && typeof API_BASE_URL !== 'undefined') {
                        // 2. Usa keepalive: true para garantir o envio mesmo trocando de aba/app
                        fetch(`${API_BASE_URL}/api/public/psychologists/${slug}/whatsapp-click`, { 
                            method: 'POST',
                            keepalive: true, // Mant√©m a requisi√ß√£o viva em background
                            headers: { 'Content-Type': 'application/json' }
                        }).catch(err => {
                            // Log silencioso no console em caso de erro, n√£o interfere com o usu√°rio.
                            console.warn('Falha ao registrar clique no WhatsApp:', err);
                        });
                    }
                    // Removemos preventDefault() para o link abrir nativamente (melhor para mobile)
                });
            }

            // L√≥gica para clicar nas estrelas e descer para avalia√ß√µes
            const ratingDisplay = document.getElementById('hero-rating-display');
            if (ratingDisplay) {
                ratingDisplay.addEventListener('click', () => {
                    const reviewsSection = document.getElementById('tab-avaliacoes');
                    if(reviewsSection) reviewsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                });
            }

            // Hook para renderizar badges quando os dados chegarem (assumindo que perfil_psicologo.js preenche os dados)
            // Vamos observar mudan√ßas ou esperar que o script principal chame renderBadges
            // Se voc√™ estiver usando fetch no perfil_psicologo.js, adicione:
            // if (data.badges) renderBadges(data.badges);
            // Como n√£o tenho acesso ao perfil_psicologo.js aqui, deixo a fun√ß√£o global dispon√≠vel.

            // --- L√ìGICA DE TOOLTIP PARA BADGES NO MOBILE ---
            function setupMobileBadgeTooltips() {
                document.body.addEventListener('click', function(e) {
                    const existingTooltip = document.querySelector('.mobile-badge-tooltip');
                    
                    // Se clicou em um alvo de badge
                    const target = e.target.closest('.badge-card, .badge-item');

                    // Primeiro, remove qualquer tooltip existente
                    if (existingTooltip) {
                        existingTooltip.remove();
                    }

                    // Se n√£o clicou em um alvo de badge, ou se estamos no desktop, apenas saia
                    if (!target || window.innerWidth > 992) {
                        return;
                    }
                    
                    // Se clicou em um alvo, previne outras a√ß√µes e mostra o novo tooltip
                    e.preventDefault();
                    e.stopPropagation();

                    const title = target.getAttribute('title');
                    if (!title) return;

                    // Cria o novo tooltip
                    const tooltip = document.createElement('div');
                    tooltip.className = 'mobile-badge-tooltip';
                    tooltip.textContent = title;
                    document.body.appendChild(tooltip);

                    // Posiciona o tooltip
                    const targetRect = target.getBoundingClientRect();
                    const tooltipRect = tooltip.getBoundingClientRect();

                    let top = targetRect.bottom + 10;
                    tooltip.classList.add('bottom');

                    if ((top + tooltipRect.height) > window.innerHeight - 20) {
                        top = targetRect.top - tooltipRect.height - 10;
                        tooltip.classList.remove('bottom');
                        tooltip.classList.add('top');
                    }
                    
                    let left = targetRect.left + (targetRect.width / 2) - (tooltipRect.width / 2);
                    if (left < 10) left = 10;
                    if (left + tooltipRect.width > window.innerWidth - 10) left = window.innerWidth - tooltipRect.width - 10;

                    tooltip.style.top = `${top}px`;
                    tooltip.style.left = `${left}px`;
                });
            }
            setupMobileBadgeTooltips();

            // --- NOVO: L√ìGICA DE AUTO-RESIZE PARA TEXTAREA DE AVALIA√á√ÉO ---
            const reviewTextarea = document.querySelector('#form-nova-avaliacao textarea');
            if (reviewTextarea) {
                const autoResize = () => {
                    reviewTextarea.style.height = 'auto';
                    reviewTextarea.style.height = reviewTextarea.scrollHeight + 'px';
                };
                reviewTextarea.addEventListener('input', autoResize);
            }
        });
    </script>
</body>
</html>